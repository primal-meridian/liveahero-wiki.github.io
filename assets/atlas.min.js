'use strict';class AtlasStitcher{constructor(){this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d")}draw(a,b,c,l){const f=a.height,g=a.width;var e=b.width;const h=b.height,k=c.padding;c=c.cellSize;const d=c-2*k,n=e+d-1-(e+d-1)%d,p=h+d-1-(h+d-1)%d;this.canvas.width=e;this.canvas.height=h;this.ctx.clearRect(0,0,e,h);e=0;for(const m of b.cellIndexList){if(m!=b.transparentIndex){const q=e%(n/d)*d,r=p-d*(1+intdiv(e,n/d))-(p-h),t=m%(g/c)*c+k,u=f-c*(1+intdiv(m,g/c))+k;this.ctx.drawImage(a,t,u,d,d,q,r,d,d)}e++}l.src=this.canvas.toDataURL("image/png")}}async function getJson(a){return await Promise.all(a.map(b=>fetch(`/cdn/MonoBehaviour/${b}.json`)))}async function collectSprites(a){const b=document.createElement("select"),c={};for(const l of a){a=await l.json();const f=a.m_Name;c[f]=a;for(const g of a.textureDataList)b.add(new Option(g.name,`${f}:${g.name}`))}return{manifest:c,select:b}}const atlasObserver=new IntersectionObserver((a,b)=>{a.forEach(c=>{c.isIntersecting&&(atlasHandler(c.target),b.unobserve(c.target))})});async function atlasHandler(a){var b=a.dataset.sprites.split(",");const c=a.querySelector("img");b=await getJson(b);const {manifest:l,select:f}=await collectSprites(b);a.appendChild(f);f.addEventListener("change",()=>{const g=f.value.split(":"),e=l[g[0]],h=e.textureDataList.find(d=>d.name==g[1]),k=new Image;k.onload=()=>{window.atlasSticher=window.atlasSticher||new AtlasStitcher;atlasSticher.draw(k,h,e,c)};k.src=`/cdn/Texture2D/${h.atlasName}.png`});f.dispatchEvent(new Event("change"))}document.querySelectorAll(".atlas-gallery").forEach(a=>atlasObserver.observe(a));function intdiv(a,b){return Math.floor(a/b)};